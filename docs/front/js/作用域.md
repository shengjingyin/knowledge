如何能讲好闭包理解闭包的作用？

理解闭包的作用

闭包的实际使用场景

能不能把闭包讲的通俗易懂，讲述它的核心？

理解闭包需要理解两个核心概念：**变量的作用域**、**变量的生存周期**。

### 变量的作用域

> 就是变量的有效范围

### 变量的生存周期

+ 全局变量，永久（除非程序退出或者主动销毁这个变量）
+ 局部变量，在函数内声明的变量，在函数退出时，这些局部变量也就失去了它们存在的价值，它们都会随着函数的调用结束而被销毁

#### 函数退出时，销毁变量

```
let func = function() {
 	let a = 1;
 	alert(a);
}

func();
```

#### 函数退出时，未销毁变量

```
let func = function() {
 	let a = 1;
 	return function() {
 		a++;
 		alert(a);
 	}
}

const f  = func();

f();	// 2
f();	// 3
f();	// 4
```

和上述声明周期不同，函数退出后，a变量没有销毁，这里产生的便是一个闭包结构

### 应用

#### 缓存计算结果

```js
const mult = (function () {
	let catch = {}
	return function() {
		let args = Array.prototype.join.call(arguments, ',')
		if (args in catch) {
			return catch[args]
		}
		let ret = 1
        for (let i = 0; i < arguments.length; i++) {
            ret *= arguments[i]
        }
        return catch[args] = a
	}
})()
```

#### 数据上报

```js
const report = function(src) {
    const img = new Image()
    img.src = src
}

report('http://juliya.icu/report')	// 发送请求
```

在低版本浏览器中，上述方法会丢失30%左右的数据（并不是每一次都成功发送请求），因为img是局部变量，当report调用结束后，img被销毁，此时或许还没有发送请求，所以请求会丢失，通过闭包就可以解决这个问题

```js
const report = (function() {
    const imgs = []
    return function(src) {
        const img = new Image()
        imgs.push(img)	// 临时存储img对象给闭包属性imgs，避免img被销毁
        img.src = src
    }
})()

report('http://juliya.icu/report')	// 发送请求
```

