> 像 C 语言这样的底层语言一般都有底层的内存管理接口，比如 malloc()和 free()。相反，JavaScript 是在创建变量（对象，字符串等）时自动进行了分配内存，并且在不使用它们时“自动”释放。释放的过程称为垃圾回收。这个“自动”是混乱的根源，并让 JavaScript（和其他高级语言）开发者错误的感觉他们可以不关心内存管理。 ---- MDN

## JavaScript 的变量存储机制

这个机制是个比较“虚”的话题，目前没有找到相关官方的文档有说堆栈内存，大部分 baidu 看到的答案如下：

在 js 引擎中对变量的存储主要有两种位置，**堆内存和栈内存**，这两位分工合作，分别保管 JS 中的两种数据类型：基本数据类型和复杂数据类型

要知道堆栈，首先我们先了解下 ECMAScript 数据类型，数据类型整体可分为两种**基本数据类型** & **复杂数据类型**：

- 基本类型：Number、String、Boolean、null、undefined、Symbol；
- 复杂类型：Object（Object、Array、function、Date、RegExp）。

声明变量之后是如何进行存储的呢？

在 js 引擎中对变量的存储主要有两种位置，**堆内存和栈内存**，不同类型的数据存储方式不同，总结两句话如下：

- 基本类型：基本类型值在内存中占据固定大小，保存在**栈内存**中
- 引用类型：引用类型的值是**对象**，保存在**堆内存**中，而**栈内存**存储的是**对象的变量标识符**以及**对象在堆内存中的存储地址**

上面两句话我将引入两张图来助大家理解

- 基本数据类型存储方式

  ```js
  let a = 1;
  let b = true;
  let c = null;
  ```

  当我声明三个基本数据类型的变量时，**栈内存**存储变量的方式类似下图所示保存在栈内存中，基本数据类型占用空间小、大小固定，通过值来访问。

  <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc644312d6624a3eb3fc7c5655a240d0~tplv-k3u1fbpfcp-watermark.awebp" alt="image-20210813214521711.png" style="zoom:50%;" />

- 复杂数据类型存储方式

  ```js
  let obj = {}；
  let arr = [];
  let map = new Map();
  ```

  当我声明了以上三个复杂数据类型时，**栈、堆内存**存储变量的方式类似下图所示，在栈内存中存取的是数据实体的引用地址，这个应用地址能够从堆内存中找到对应的实体数据，解释器寻找复杂数据类型时，需要先获取栈中的地址，取得地址后，再从堆中获得实体数据

  <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4cc819b696240b88a79f7a3317f2af4~tplv-k3u1fbpfcp-watermark.awebp" alt="image-20210815205530589.png" style="zoom:50%;" />

  这里的栈内存存储的是复制数据类型的**引用地址**，可以在堆内存中通过这个引用地址获取到对应的复杂数据类型

---
