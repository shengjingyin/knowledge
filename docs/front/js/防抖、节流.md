## è§£ç­”é˜²æŠ–

è¿™ä¸ªæ¦‚å¿µé€šå¸¸ä¸èŠ‚æµè¢«ä¸€èµ·è®¨è®ºï¼Œå› ä¸ºä»–ä»¬çš„ä½œç”¨å¾ˆç›¸ä¼¼ï¼Œå­˜åœ¨ç»†å¾®å·®åˆ«ï¼Œå…±åŒä¹‹å¤„éƒ½æ˜¯ç”¨äºè§£å†³å‡½æ•°ï¼ˆäº‹ä»¶ï¼‰è¢«é¢‘ç¹è°ƒç”¨çš„é—®é¢˜ï¼Œéœ€è¦å‡å°‘å‡½æ•°ï¼ˆäº‹ä»¶ï¼‰çš„è§¦å‘æ¬¡æ•°ï¼Œå› è€Œå¾—åé˜²æŠ–ã€‚

ä¸å®ƒçš„åå­—ç±»ä¼¼ï¼Œæˆ‘å…ˆä¸¾ä¸ªç”Ÿæ´»ä¸­å½¢è±¡çš„ä¾‹å­æ¥è¯´æ˜é˜²æŠ–ï¼Œæƒ³å¿…ç”µæ¢¯å¾ˆç†Ÿæ‚‰å§ï¼Œä¸‹é¢æ¥ä¸€å¼ å¤§ä¼™æ’é˜Ÿè¿›å…¥ç”µæ¢¯çš„åŠ¨æ¼«å›¾

![8644ebf81a4c510f660c27b12f0f6a2bd52aa](D:\Project\image-host\img\8644ebf81a4c510f660c27b12f0f6a2bd52aa52a.jpeg)

çœ‹ä¸Šå›¾ï¼Œå¤§ä¼™ä¸€ä¸ªæ‹ä¸€ä¸ªæ¥ç€è¿›å…¥ç”µæ¢¯ï¼Œç”µæ¢¯ä¼šç­‰åˆ°æœ€åä¸€ä¸ªäººè¿›å»ä¹‹åï¼Œå†è¿‡ä¸Šè®¾å®šå¥½çš„ç§’æ•°ä¹‹åå…³é—­ç”µæ¢¯é—¨ï¼Œæ‰§è¡Œä¸Šæˆ–è€…ä¸‹çš„å‡½æ•°ã€‚

è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå½¢è±¡çš„é˜²æŠ–ï¼Œå¦‚æœä¸€ç›´å†è§¦å‘é˜²æŠ–å‡½æ•°ï¼Œé‚£ä¹ˆé˜²æŠ–å‡½æ•°ä¼šç­‰å¾…è§¦å‘çš„åŠ¨æœºæ¶ˆåœäº†ï¼Œå†ç­‰ä¸Šè®¾å®šå¥½çš„æ—¶é—´ï¼Œæœ€åæ‰ä¼šå»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

å†æ¥ä¸€ä¸ªå®é™…å¼€å‘ä¸­çš„æ¡ˆä¾‹:

ç›‘å¬æ»šåŠ¨æ¡æ»šåŠ¨äº‹ä»¶ï¼ˆå®é™…ä¸Šå…¶å®ƒäº‹ä»¶ä¹Ÿå¯ä»¥åˆ›é€ è¿™ç§æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šé¼ æ ‡ç§»åŠ¨ï¼‰, ç„¶åè¿”å›æ‰“å°å‡ºæ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„é«˜åº¦

```js
window.onscroll = listenScroll;

function listenScroll() {
	let scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
	console.log("æ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„é«˜åº¦: ", scrollTop);
}
```

<img src="D:\Project\image-host\img/image-20210820224526410.png" style="zoom: 33%;" />

ä»…ä»…æ˜¯ä»ä¸Šé¢æ»šåŠ¨åˆ°ä¸‹é¢,å°±æ‰“å°äº†ä¸€å¤§æ‰¹.

è™½ç„¶æ»¡è¶³éœ€æ±‚, ä½†è¿™ä¹Ÿå¼•å‘å‡ºä¸€ä¸ªé—®é¢˜, æˆ‘çœŸçš„éœ€è¦è¿™ä¹ˆé¢‘ç¹çš„å»ç›‘å¬æ»šåŠ¨äº‹ä»¶å—? å‡å¦‚æˆ‘ç›‘å¬çš„äº‹ä»¶å¤„ç†é‡Œé¢æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„æ“ä½œ, é‚£è¿™æ ·ä¸æ˜¯ç™½ç™½æµªè´¹äº†æµè§ˆå™¨æ€§èƒ½å—?

æœ‰åŠæ³•è§£å†³å—?

â€‹ æœ‰ , å°±å’Œæˆ‘ä¸Šé¢ä»‹ç»çš„ä¸Šç”µæ¢¯æ˜¯ä¸€ä¸ªæ€§è´¨çš„é—®é¢˜, è§£å†³åŠæ³•å°±æ˜¯ : æˆ‘ç­‰æ‰€æœ‰äººéƒ½ä¸Šæ¥äº†, å†å»æ‰§è¡Œå…³é—­ç”µæ¢¯é—¨.

â€‹ åŒç†è¿™é‡Œå°±æ˜¯: æˆ‘ç­‰å¾…ç”¨æˆ·åœæ­¢æ“ä½œæ»šåŠ¨æ¡äº†, æˆ‘å†å»å›è°ƒå‡½æ•°, è‡³äºè¿™ä¸ªæ€ä¹ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœæ­¢æ“ä½œæ»šåŠ¨æ¡è¿™å°±å› äººè€Œå¼‚äº†(200ms æœªæ“ä½œæ»šåŠ¨æ¡ æˆ–è€… 300ms ä¹Ÿè¡Œ)

è¿™é‡Œç»™äº†ä¸€ä¸ªç®€å•ç‰ˆæœ¬çš„é˜²æŠ–å‡½æ•°,ä¸»è¦è¿ç”¨äº†**é—­åŒ…**ä¿å­˜å®šæ—¶å™¨

```js
/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} delay - ç­‰å¾…æ—¶é—´
 */
function debounce(fn, delay) {
    let timer = null;
    return function () {
        // è¿™é‡Œè¡¨ç¤ºå¦‚æœæœ‰timer,åˆ™è¯´æ˜ä¹‹å‰æœ‰è°ƒç”¨è¿‡,è§£é™¤ä¹‹å‰çš„å®šæ—¶å™¨;é‡æ–°è®¾ç½®å®šæ—¶å™¨è®¡æ—¶å›è°ƒå‡½æ•°è§¦å‘çš„æ—¶æœºâ²
        if (timer) {
            clearTimeout(timer);
        }
        timer = setTimeout(fn, delay);
    };
}

ä½¿ç”¨æ—¶åˆ™éœ€è¦æŠŠä¸Šé¢ç›‘å¬çš„å‡½æ•°çš„æ–¹å¼æ”¹ä¸€ä¸‹
window.onscroll = listenScroll
- æ”¹æˆ:
window.onscroll = debounce(listenScroll, 200)

```

![image-20220103102829414](D:\Project\image-host\img/image-20220103102829414.png)

åŒæ ·çš„å›è°ƒå‡½æ•°ç»è¿‡`debounce`é˜²æŠ–å¤„ç†ä¹‹åæˆ‘ä»¬çœ‹åˆ°æ•ˆæœå·²ç»å¥½å¾ˆå¤šäº†ä»…ä»…è§¦å‘äº†ä¸‰æ¬¡(æ»šåŠ¨è¿‡ç¨‹ä¸­æˆ‘æ‹–åŠ¨æ»šåŠ¨æ¡æœ‰åœé¡¿, æ‰‹æ®‹å…š ğŸ˜‚ ) è¿™å°±èƒ½è¾¾åˆ°å¾ˆå¥½çš„é™ä½è§¦å‘å›è°ƒå‡½æ•°çš„é¢‘ç‡äº†!ä½†åŒæ—¶è¿™é‡Œä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œåç»­æˆ‘å°†è¡¥ä¸Šè¿™é‡Œç©¶ç«Ÿå­˜åœ¨ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œä»¥åŠè¡¥å……è§£ç­”ä¸€ä¸ªé«˜é…ç‰ˆçš„é˜²æŠ–å‡½æ•°ï¼ˆ[underscore](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flessfish%2Funderscore-analysis%2Fblob%2Fmaster%2Funderscore-1.8.3.js%2Fsrc%2Funderscore-1.8.3.js)ï¼‰

### åº”ç”¨åœºæ™¯

-   scroll æ»šåŠ¨äº‹ä»¶
-   æœç´¢æ¡†è¾“å…¥æŸ¥è¯¢äº‹ä»¶
-   è¡¨å•éªŒè¯
-   æŒ‰é’®æäº¤äº‹ä»¶
-   æµè§ˆå™¨çª—å£ç¼©æ”¾äº‹ä»¶

---

## é«˜é…é˜²æŠ–

ä¸Šæ–‡[é˜²æŠ–ç®€ä»‹](https://juejin.cn/post/6998732773730615327)ä¸­ç®€å•ä»‹ç»äº†ä¸€ä¸‹é˜²æŠ–çš„ä½¿ç”¨åœºæ™¯ä»¥åŠä¸€ä¸ªç®€å•ç‚¹å®ç°çš„ä¾‹å­, æ”¯æŒä¸€èˆ¬çš„éœ€æ±‚ï¼Œå®ƒå­˜åœ¨ä¸€äº›ä½¿ç”¨æ–¹é¢çš„é™åˆ¶ï¼Œè­¬å¦‚

æœ‰æ²¡æœ‰åŠŸèƒ½ä¸°å¯Œçš„é˜²æŠ–?

æœ‰! å®ƒæ¥äº† æœ¬æ–‡å°†è§£ç­”ä¸€ä¸ªé«˜é…ç‰ˆæœ¬çš„é˜²æŠ–[underscore](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flessfish%2Funderscore-analysis%2Fblob%2Fmaster%2Funderscore-1.8.3.js%2Fsrc%2Funderscore-1.8.3.js)åº“ä¸­çš„é˜²æŠ–å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦è§£å†³äº†ä¸‰ä¸ªé—®é¢˜

-   æ‰§è¡Œå‡½æ•°çš„ this æŒ‡å‘é—®é¢˜
-   æ‰§è¡Œå‡½æ•°çš„å‚æ•°è·å–é—®é¢˜
-   ç«‹å³æ‰§è¡Œ

> å…ˆä»‹ç»ä¸€ä¸‹å®ä¾‹åº”ç”¨èƒŒæ™¯ï¼šæœ‰ä¸€ä¸ª divï¼Œåœ¨ div ä¸Šç§»åŠ¨è§¦å‘å›è°ƒå‡½æ•°`listenMoveOn`ï¼Œè¿™é‡Œä½¿ç”¨äº†ç®€å•ç‰ˆæœ¬çš„é˜²æŠ–ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º

```html
<style>
	div {
		background-color: #666;
		height: 300px;
	}
</style>

<div></div>

<script>
	let dom = document.getElementsByTagName("div")[0];
	dom.onmousemove = debounce(listenMoveOn, 200);

	function listenMoveOn() {
		// ç›‘å¬çš„å›è°ƒåšä¸€äº›äº‹æƒ…
	}
	/**
	 *
	 * @param {function} fn - å›è°ƒå‡½æ•°
	 * @param {number} delay - ç­‰å¾…æ—¶é—´
	 */
	function debounce(fn, delay) {
		var timer = null;
		return function (...args) {
			clearTimeout(timer);
			timer = setTimeout(fn, delay);
		};
	}
</script>
```

### this æŒ‡å‘é—®é¢˜

è¿™é‡Œ`listenMoveOn`ä¸­æ‰“å°çš„ this æŒ‡å‘ windowï¼ŒåŸå› åœ¨äº`listenMoveOn`æ˜¯é€šè¿‡`setTimeout`è°ƒç”¨çš„ï¼Œè¿˜è®°å¾—è¿™æ˜¯è°çš„æ–¹æ³•å—ï¼Ÿ`window.setTimeout`ï¼Œå°±æ˜¯å®ƒ`window`ï¼ï¼ï¼æ‰€ä»¥`listenMoveOn`ä¸­çš„ this æŒ‡å‘ window

ç”±äº`onmousemove`ç›‘å¬çš„å›è°ƒæ˜¯`debounce`å‡½æ•°ä½“è¿”å›çš„é‚£ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä½“å†…çš„ this æ˜¯æŒ‡å‘è¿™ä¸ª dom å…ƒç´ çš„

```js
function listenMoveOn() {
    // this -> window
}
function debounce(fn, delay) {
    ...
    return function () {
        // this -> dom
    };
}
```

æ—¢ç„¶äº‹æƒ…å·²ç»æ˜äº†ï¼Œé‚£ä¹ˆæ”¹å˜`listenMoveOn`å‡½æ•°ä½“ä¸­çš„ this æŒ‡å‘åº”è¯¥ä¸æ˜¯éš¾äº‹äº†å§ï¼Ÿå¦‚ä¸‹ä½¿ç”¨ apply

```js
function listenMoveOn() {
    // this -> dom
}
function debounce(fn, delay) {
    ...
    return function () {
        // this -> dom
        ...
        timer = setTimeout(() => {
            fn.apply(this)			// åœ¨è¿™é‡Œæ”¹å˜listenMoveOnçš„thisæŒ‡å‘
        }, delay);
    };
}
```

### ä¼ å‚é—®é¢˜

è¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥å’Œ this æŒ‡å‘ä¸€èµ· è§£å†³ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³å¤šè¯´ä¸¤å¥ï¼Œå› ä¸ºæˆ‘ç›‘å¬é¼ æ ‡ç§»åŠ¨çš„äº‹ä»¶æ˜¯`debounce`å‡½æ•°ä½“è¿”å›çš„é‚£ä¸ªå‡½æ•°ï¼Œå°±æ˜¯ä¸‹å›¾æˆ‘çº¢è‰²æ¡†æ¡†æ¡†ä½çš„ä½ç½®ï¼Œjs äº‹ä»¶é€šå¸¸éƒ½ä¼šè¿”å›ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œæˆ‘ç›®å‰åªèƒ½åœ¨`debounce`ä¸­è·å–ï¼Œåœ¨äº‹ä»¶å›è°ƒä¸­æ˜¯è·å–ä¸åˆ°çš„ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹

```js
function listenMoveOn(...args) {
    let [event] = args
    // argså¯ä»¥è·å–åˆ°äº‹ä»¶ç›‘å¬è¿”å›çš„äº‹ä»¶å¯¹è±¡
    // this -> dom
}
function debounce(fn, delay) {
    ...
    return function (...args) {
        // this -> dom
        ...
        timer = setTimeout(() => {
            fn.apply(this, args)	// åœ¨è¿™é‡Œæ”¹å˜listenMoveOnçš„thisæŒ‡å‘çš„åŒæ—¶ä¼ å…¥ç›‘å¬å¯¹è±¡è·å–åˆ°çš„å‚æ•°
        }, delay);
    };
}
```

### ç«‹å³æ‰§è¡Œ

è¿™ä¸ªå®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œå¯¹äºæºç æˆ‘ä¹Ÿç¨åŠ æ”¹å˜ï¼ŒåŠŸèƒ½å®ç°åŸç†ä¸€æ ·

```js
function listenMoveOn(...args) {
	// ç›‘å¬çš„å›è°ƒåšä¸€äº›äº‹æƒ…
	// this -> dom
	// args -> [event]
}

/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} delay - ç­‰å¾…æ—¶é—´
 * @param {boolean} immediate - æ˜¯å¦ç«‹å³æ‰§è¡Œ
 */
function debounce(fn, delay, immediate = false) {
	/**
	 *
	 * @param timer - å®šæ—¶å™¨
	 * @param timestamp - å½“å‰æ—¶é—´
	 * @param context - ä¿å­˜ä¸Šä¸‹æ–‡ä½¿ç”¨
	 * @param param - ä¿å­˜äº‹ä»¶å‚æ•°ä½¿ç”¨
	 */
	let timer, timestamp, context, param;

	const later = function () {
		let last = +new Date() - timestamp; // è·ç¦»ä¸Šä¸€æ¬¡æ“ä½œçš„æ—¶é—´é—´éš”ms
		if (last < delay && last >= 0) {
			timer = setTimeout(later, delay); // é‡ç½®å®šæ—¶å™¨
		} else {
			// è¿›å…¥ else è¯´æ˜è®¾ç½®çš„delayæ—¶é—´å·²ç»åˆ°äº†
			timer = null; // æ¸…é™¤é—­åŒ…ä¸­çš„ä¿å­˜çš„å˜é‡ï¼Œå¹¶ä¸”å¦‚æœæœ‰åç»­çš„è¯ï¼Œå¯ä»¥è®©ç«‹å³è°ƒç”¨ä¸­çš„callNowæ›´æ”¹ä¸ºtrueï¼Œè¿›è¡Œè°ƒç”¨äº‹ä»¶å›è°ƒå‡½æ•°
			if (!immediate) {
				fn.apply(context, param); // å¦‚æœimmediate = falseéœ€è¦è°ƒç”¨ä¸€ä¸‹äº‹ä»¶å¤„ç†å‡½æ•°ï¼›å½“immediate = true æ—¶ï¼Œå› ä¸ºç«‹å³è°ƒç”¨è¿‡ï¼Œæ‰€ä»¥åœ¨åé¢å°±ä¸éœ€è¦è°ƒç”¨ï¼Œåœ¨æœ¬æ®µä»£ç  å€’æ•°ç¬¬äº”è¡Œ æ‰§è¡Œç«‹å³è°ƒç”¨
				context = param = null; // æ¸…é™¤é—­åŒ…ä¸­çš„ä¿å­˜çš„å˜é‡
			}
		}
	};

	return function (...args) {
		context = this; // ä¿å­˜å˜é‡åˆ°é—­åŒ…å†…ï¼Œæ–¹ä¾¿åé¢è°ƒç”¨æ—¶æ‹¿åˆ°å€¼
		param = args;
		timestamp = +new Date();

		let callNow = immediate && !timer; // å½“ immediate è®¾ç½®trueï¼Œå¹¶ä¸”timerè¿˜æ²¡æœ‰è¢«èµ‹å€¼æ—¶ï¼Œè¯´æ˜åˆšè¿›æ¥ï¼Œå¯è¿›è¡Œç«‹åˆ»è°ƒç”¨ï¼Œä¸‹é¢ä¸€å¥è¯å°±ä¼šé‡æ–°èµ‹å€¼timer
		if (!timer) timer = setTimeout(later, delay); // å½“ç¬¬ä¸€æ¬¡è¿›å…¥æˆ–è€…timerè¢«æ¸…é™¤åï¼ˆè¡¨ç¤ºå·²ç»è°ƒç”¨è¿‡ä¸€æ¬¡ï¼‰æ‰èƒ½å†ç»§ç»­è®¾ç½®timer
		if (callNow) {
			fn.apply(context, args); // ç«‹å³æ‰§è¡Œçš„è°ƒç”¨ä¸€ç›´éƒ½æ˜¯åœ¨è¿™é‡Œ,åé¢å¦‚æœè¿˜æœ‰ç»§ç»­æ“ä½œï¼Œä¹Ÿæ˜¯åœ¨è¿™é‡Œè°ƒç”¨
			context = param = null; // æ¸…é™¤é—­åŒ…ä¸­çš„ä¿å­˜çš„å˜é‡
		}
	};
}
```

å…¶å®ç«‹å³æ‰§è¡Œå’Œéç«‹å³æ‰§è¡Œçš„è¿è¡Œæ¬¡æ•°æ˜¯ä¸€æ ·çš„ï¼Œå°±çœ‹ä½ æƒ³è¦æœ‰åŒºåˆ«çš„ä¸€æ¬¡æ˜¯å¼€å§‹æ‰§è¡Œï¼Œè¿˜æ˜¯æ”¾åœ¨æœ«å°¾æ‰§è¡Œ

å°±åƒä¸‹é¢è¿™æ ·ï¼ˆè¿™é‡Œçš„æ•°å€¼å¯ä»¥å½“ä½œæ—¶é—´ï¼‰

| ç±»åˆ«       |       |     |     |       |
| ---------- | ----- | --- | --- | ----- |
| ç«‹å³æ‰§è¡Œ   | **0** | 1   | 2   |       |
| éç«‹å³æ‰§è¡Œ |       | 1   | 2   | **3** |
|            |       |     |     |       |

### underscore ä¸­çš„ debounce æºç æ¬£èµ

```js
// Returns a function, that, as long as it continues to be invoked, will not
// be triggered. The function will be called after it stops being called for
// N milliseconds. If `immediate` is passed, trigger the function on the
// leading edge, instead of the trailing.
_.debounce = function (func, wait, immediate) {
	var timeout, args, context, timestamp, result;

	var later = function () {
		var last = _.now() - timestamp;

		if (last < wait && last >= 0) {
			timeout = setTimeout(later, wait - last);
		} else {
			timeout = null;
			if (!immediate) {
				result = func.apply(context, args);
				if (!timeout) context = args = null;
			}
		}
	};

	return function () {
		context = this;
		args = arguments;
		timestamp = _.now();
		var callNow = immediate && !timeout;
		if (!timeout) timeout = setTimeout(later, wait);
		if (callNow) {
			result = func.apply(context, args);
			context = args = null;
		}

		return result;
	};
};
```

[æœ¬æ–‡æºç åœ°å€](https://gitee.com/sjy666666/juejin-case/blob/master/js%E5%9F%BA%E7%A1%80/%E9%98%B2%E6%8A%96%E3%80%81%E8%8A%82%E6%B5%81.html)

## è§£ç­”èŠ‚æµ

> å‰æ–‡å®Œæ•´ä»‹ç»äº†èŠ‚æµçš„å…„å¼Ÿï¼šé˜²æŠ–ï¼ˆ[åˆå§‹é˜²æŠ–](https://juejin.cn/post/6998732773730615327)ã€[ä» underscore åº“ä¸­å­¦ä¹  debounce](https://juejin.cn/post/6999118646140370957/#heading-0)ï¼Œå‡è®¾æ˜å‹æš‚æ—¶ä¸äº†è§£è¿™ä¸ªï¼Œç›¸ä¿¡ä»è¿™ä¸¤ç¯‡ä¸­æ˜å‹å®šä¼šæœ‰æ‰€æ”¶è·ï¼‰ï¼Œæœ¬æ–‡å¼€å§‹è®²è§£èŠ‚æµ

èŠ‚æµåº”ç”¨äºï¼šå½“é‡å¤è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œè‡³å°‘æ¯éš” **wait**æ¯«ç§’è°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•°ã€‚å¯¹äºæƒ³æ§åˆ¶ä¸€äº›è§¦å‘é¢‘ç‡è¾ƒé«˜çš„äº‹ä»¶æœ‰å¸®åŠ©ã€‚å°±åƒæ˜¯æœªå®Œå…¨æ‰“å¼€çš„æ°´é¾™å¤´ä¸€æ ·ï¼Œä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸‹æµï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½ç›¸å½“äºè°ƒç”¨äº†ä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚

<img src="D:\Project\image-host\img/image-20210822164117591.png" style="zoom:25%;" />

èŠ‚æµå¸¸è§åº”ç”¨åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š

-   dom å…ƒç´ æ‹–æ‹½
-   è®¡ç®—é¼ æ ‡ç§»åŠ¨çš„è·ç¦»
-   ç›‘å¬ scroll æ»šåŠ¨

> å…ˆä»‹ç»ä¸€ä¸‹å®ä¾‹åº”ç”¨èƒŒæ™¯ï¼šæœ‰ä¸€ä¸ª divï¼Œåœ¨ div ä¸Šç§»åŠ¨è§¦å‘å›è°ƒå‡½æ•°`listenMoveOn`ï¼Œè¿™é‡Œä½¿ç”¨äº†ç®€å•ç‰ˆæœ¬çš„èŠ‚æµï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º

### ç¬¬ä¸€æ—¶é—´è§¦å‘ï¼Œæœ«å°¾ä¸è§¦å‘

é€šè¿‡æ—¶é—´æˆ³å®ç°èŠ‚æµï¼Œè¿™ç§æ–¹å¼ä¼šåœ¨è¿›å…¥ throttle å‡½æ•°ä¸­å°±ä¼šè§¦å‘äº‹ä»¶ç›‘å¬å›è°ƒ

```html
<style>
	div {
		background-color: #666;
		height: 300px;
	}
</style>

<div></div>

<script>
	let dom = document.getElementsByTagName("div")[0];
	dom.onmousemove = throttle(listenMoveOn, 200);

	function listenMoveOn() {
		// ç›‘å¬çš„å›è°ƒåšä¸€äº›äº‹æƒ…
	}
	/**
	 *
	 * @param {function} fn - å›è°ƒå‡½æ•°
	 * @param {number} wait - è§¦å‘é—´éš”æ—¶é—´
	 */
	function throttle(fn, wait) {
		let timer, old, now, context, args;
		old = 0;

		return function () {
			now = +new Date();
			context = this;
			args = arguments;
			if (now - old > wait) {
				// å› ä¸º now - 0 å¿…å®šå¤§äºwaitï¼Œæ‰€ä»¥è¿™ç§å®ç°æ–¹å¼ é¦–æ¬¡è‚¯å®šä¼šè§¦å‘
				fn.apply(context, args);
				old = now;
			}
		};
	}
</script>
```

### ä¸ç«‹å³è§¦å‘ï¼Œæœ«å°¾è§¦å‘

ä½¿ç”¨`setTimeout`å®ç°èŠ‚æµï¼Œè¦ç­‰åˆ°æ—¶é—´è¾¾æ ‡æ‰ä¼šå»è§¦å‘ï¼Œæ‰€ä»¥é¦–æ¬¡ä¸ä¼šè§¦å‘ï¼Œåé¢å‡ºå»ä¹‹åç”±äºæœ‰`setTimeout`çš„å­˜åœ¨ï¼Œè¿˜ä¼šè¡¥ä¸Šä¸€æ¬¡

```html
<script>
	/**
	 *
	 * @param {function} fn - å›è°ƒå‡½æ•°
	 * @param {number} wait - è§¦å‘é—´éš”æ—¶é—´
	 */
	function throttle(fn, wait) {
		let timer, context, args;

		return function () {
			context = this;
			args = arguments;
			if (!timer) {
				timer = setTimeout(() => {
					timer = null; // ç¡®ä¿ä¸‹æ¬¡è¿›æ¥æ—¶èƒ½å¤Ÿé‡æ–°è®¾ç½®å®šæ—¶å™¨
					fn.apply(context, args);
				}, wait);
			}
		};
	}
</script>
```

### å°ç»“

æœ¬èŠ‚ä¸»è¦è®²äº†ä¸¤ä¸ªç‰ˆæœ¬ç±»å‹çš„èŠ‚æµæ–¹å¼å®ç°ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å„æœ‰ç‰¹è‰²ï¼Œä¸‹ä¸€èŠ‚å°†å‚è€ƒ underscore ä¸­çš„ throttle è¿›è¡Œè§£æé«˜é…ç‰ˆæœ¬çš„èŠ‚æµã€‚

---

## é«˜é…èŠ‚æµ

å‰æ–‡è®²åˆ°ä¸¤ç§å®ç°ç‰ˆæœ¬çš„èŠ‚æµï¼Œè¿™é‡Œçš„é«˜é…ç‰ˆæœ¬ä¸»è¦å°†æŠŠè¿™ä¸¤ç§ç‰ˆæœ¬è¿›è¡Œä¼˜åŠ¿äº’è¡¥ï¼Œåˆå¹¶æˆä¸€ä¸ªèŠ‚æµå‡½æ•°ï¼Œé€šè¿‡ä¼ å‚æ§åˆ¶å…·ä½“æ˜¯è¦ç¬¬ä¸€æ—¶é—´æ‰§è¡Œã€æˆ–è€…æœ€åä¸€æ¬¡æ‰§è¡Œï¼Œåˆæˆ–è€…ä¸¤è€…å…¼å¾—è¿™ä¸‰ç§æƒ…å†µ

### åˆ†æ

ä½¿ç”¨`æ—¶é—´æˆ³`å¯ä»¥è®©èŠ‚æµå‡½æ•°ç«‹å³æ‰§è¡Œï¼Œä½¿ç”¨`setTimeout`å¯ä»¥è®©èŠ‚æµå‡½æ•°å»¶è¿Ÿæ‰§è¡Œï¼Œé€šè¿‡å˜é‡æ§åˆ¶å³å¯ä»¥è¾¾åˆ°ä»¥ä¸Šéœ€æ±‚

é€šè¿‡é«˜é…ç‰ˆçš„èŠ‚æµ ï¼Œè¾¾åˆ°é…ç½®ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š

-   ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæœ«å°¾ä¸æ‰§è¡Œ
-   ç¬¬ä¸€æ¬¡ä¸æ‰§è¡Œï¼Œæœ«å°¾æ‰§è¡Œ
-   ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæœ«å°¾æ‰§è¡Œ

> é¦–å…ˆè¿˜æ˜¯ä»‹ç»ä¸€ä¸‹å®ä¾‹åº”ç”¨èƒŒæ™¯ï¼šæœ‰ä¸€ä¸ª divï¼Œåœ¨ div ä¸Šç§»åŠ¨è§¦å‘å›è°ƒå‡½æ•°`listenMoveOn`ï¼Œè¿˜æ˜¯è¿™ä¹ˆä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå…·ä½“è¿˜æ˜¯é€šè¿‡ä»£ç å»å®ç°çœ‹çœ‹ï¼Œè¯¦ç»†å†…å®¹é€šè¿‡æ³¨é‡Šä½“ç°

### ä»£ç å®ç°

```html
<style>
	div {
		background-color: #666;
		height: 300px;
	}
</style>

<div></div>

<script>
	let dom = document.getElementsByTagName("div")[0];
	dom.onmousemove = throttle(listenMoveOn, 200);

	function listenMoveOn() {
		// ç›‘å¬çš„å›è°ƒåšä¸€äº›äº‹æƒ…
	}

	/**
	 *
	 * @param {function} fn - å›è°ƒå‡½æ•°
	 * @param {number} wait - ç­‰å¾…æ—¶é—´
	 * @param {obejct} options - é…ç½®ä¸‰ç§æƒ…å†µ
	 *   options = {leading: true, trailing: false}ï¼› leading æ§åˆ¶ç¬¬ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œï¼› trailing æ§åˆ¶æœ€åä¸€æ¬¡æ˜¯å¦æ‰§è¡Œ
	 */
	function throttle(fn, wait, options) {
		/**
		 *
		 * @param timer - å®šæ—¶å™¨
		 * @param now - å½“å‰æ—¶é—´
		 * @param context - ä¿å­˜ä¸Šä¸‹æ–‡ä½¿ç”¨
		 * @param args - ä¿å­˜äº‹ä»¶å‚æ•°ä½¿ç”¨
		 */
		let timer, now, context, args;
		old = 0;

		// è®¾ç½®é»˜è®¤æƒ…å†µï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæœ€åä¸€æ¬¡ä¸æ‰§è¡Œï¼‰
		if (!options) options = { leading: true, trailing: false };

		const later = () => {
			// è¿™é‡Œé‡ç½®old æ˜¯ä¸ºäº†é¿å…leadingã€trailingåŒæ—¶ä¸ºtrueä¸æ—¶é—´æˆ³é‚£è¾¹ç›¸äº’å½±å“ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºæ¸…é™¤äº†æ—¶é—´æˆ³é‚£è¾¹çš„æ“ä½œ
			old = now;

			clearTimeout(timer);
			timer = null;
			fn.apply(context, args);
		};

		return function () {
			// åŒé˜²æŠ–ä¸€æ ·ï¼Œéœ€è¦é—­åŒ…ä¿å­˜ç›¸å…³å˜é‡
			now = +new Date();
			context = this;
			args = arguments;

			// é…ç½® leading èµ°æ—¶é—´æˆ³ç®¡ç†èŠ‚æµ
			if (options.leading && now - old > wait) {
				// è¿™é‡Œé‡ç½®å®šæ—¶å™¨ æ˜¯ä¸ºäº†é¿å…leadingã€trailingåŒæ—¶ä¸ºtrueæ—¶ä¸å®šæ—¶å™¨é‚£è¾¹ç›¸äº’å½±å“ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºæ¸…é™¤äº†å®šæ—¶å™¨é‚£è¾¹çš„æ“ä½œ
				if (timer) {
					clearTimeout(timer);
					timer = null;
				}

				old = now;
				fn.apply(context, args);
			}
			// é…ç½® trailing èµ°å®šæ—¶å™¨ç®¡ç†èŠ‚æµ
			if (options.trailing && !timer) {
				timer = setTimeout(later, wait);
			}
		};
	}
</script>
```

### undercore ä¸­çš„ throttle

æœ€åè¿˜æ˜¯æ¬£èµä¸€ä¸‹ undercore ä¸­çš„ throttle æºç 

```js
_.throttle = function (func, wait, options) {
	var context, args, result;
	var timeout = null;
	var previous = 0;
	if (!options) options = {};

	var later = function () {
		// å®šæ—¶å™¨æ–¹å¼
		previous = options.leading === false ? 0 : _.now();
		timeout = null;
		result = func.apply(context, args);
		if (!timeout) context = args = null;
	};
	return function () {
		var now = _.now();
		if (!previous && options.leading === false) previous = now;
		var remaining = wait - (now - previous);
		context = this;
		args = arguments;
		// æ—¶é—´æˆ³æ–¹å¼
		if (remaining <= 0 || remaining > wait) {
			if (timeout) {
				clearTimeout(timeout);
				timeout = null;
			}
			previous = now;
			result = func.apply(context, args);
			if (!timeout) context = args = null;
		} else if (!timeout && options.trailing !== false) {
			timeout = setTimeout(later, remaining);
		}
		return result;
	};
};
```

## æ€»ç»“

é˜²æŠ–èŠ‚æµå·²ç»å…¨éƒ¨è®²å®Œï¼Œé€šè¿‡æ·±å…¥å­¦ä¹ ä¹Ÿç®—æœ‰æ‰€æ”¶è·å•¦ï¼Œä»¥å‰åªçŸ¥é“è°ƒç”¨æ²¡è¯¦ç»†äº†è§£åŸç†ï¼Œè¿™å›å½»åº•ææ‡‚äº† ğŸ˜„ çˆ±äº†çˆ±äº†

> é˜²æŠ–èŠ‚æµæ–‡ç« ç›®å½•ï¼š
>
> -   [åˆå§‹é˜²æŠ–](https://juejin.cn/post/6998732773730615327)
> -   [ä» underscore åº“ä¸­å­¦ä¹ é«˜é˜¶é˜²æŠ–](https://juejin.cn/post/6999118646140370957/#heading-0)
> -   [åˆå§‹èŠ‚æµ](https://juejin.cn/post/6999567361216872478)
> -   æœ¬æ–‡å°±ç®—æ˜¯é˜²æŠ–èŠ‚æµçš„ç»“å°¾äº†
