# é˜²æŠ–ã€èŠ‚æµ

- é˜²æŠ–ï¼ˆdebounceï¼‰ï¼šå½“äº‹ä»¶æŒç»­è§¦å‘æ—¶ï¼Œä»…å½“**æŸä¸€æ¬¡çš„è§¦å‘æ—¶é—´**ä¸**å‰ä¸€æ¬¡çš„è§¦å‘æ—¶é—´**ä¹‹å·®è¶…è¿‡é¢„è®¾æ—¶é—´æ‰ä¼šè§¦å‘

  - åº”ç”¨åœºæ™¯ï¼šåªæƒ³çŸ¥é“æœ€åä¸€æ¬¡è§¦å‘æ—¶çš„çŠ¶æ€ï¼Œæ¯”å¦‚ä½ä»£ç å¹³å°ä¸­æ‹–æ‹½ç»„ä»¶æŒç»­è§¦å‘`dragover`äº‹ä»¶ï¼Œå¯¼è‡´çŠ¶æ€æ•°æ®æŒç»­å˜åŒ–ï¼Œè¦åšåˆ°è‡ªåŠ¨ä¿å­˜çŠ¶æ€æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨é˜²æŠ–å‡å°‘å‘æœåŠ¡å™¨è¯·æ±‚çš„æ¬¡æ•°

- èŠ‚æµï¼ˆthrottleï¼‰ï¼šå½“äº‹ä»¶æŒç»­è§¦å‘æ—¶ï¼Œä¼šä»¥é¢„è®¾æ—¶é—´çš„é¢‘ç‡å»**æŒç»­è§¦å‘**
  - åº”ç”¨åœºæ™¯ï¼šè·å–è¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼Œæ¯”å¦‚é£ä¹¦æ–‡æ¡£å¯ä»¥çœ‹åˆ°å½“å‰æ–‡æ¡£æœ‰è°æ­£åœ¨æŸ¥çœ‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨èŠ‚æµå»è½®è¯¢

## é˜²æŠ–

è¿™ä¸ªæ¦‚å¿µé€šå¸¸ä¸èŠ‚æµè¢«ä¸€èµ·è®¨è®ºï¼Œå› ä¸ºä»–ä»¬çš„ä½œç”¨å¾ˆç›¸ä¼¼ï¼Œå­˜åœ¨ç»†å¾®å·®åˆ«ï¼Œå…±åŒä¹‹å¤„éƒ½æ˜¯ç”¨äºè§£å†³å‡½æ•°ï¼ˆäº‹ä»¶ï¼‰è¢«é¢‘ç¹è°ƒç”¨çš„é—®é¢˜ï¼Œéœ€è¦å‡å°‘å‡½æ•°ï¼ˆäº‹ä»¶ï¼‰çš„è§¦å‘æ¬¡æ•°ï¼Œå› è€Œå¾—åé˜²æŠ–ã€‚

ä¸å®ƒçš„åå­—ç±»ä¼¼ï¼Œæˆ‘å…ˆä¸¾ä¸ªç”Ÿæ´»ä¸­å½¢è±¡çš„ä¾‹å­æ¥è¯´æ˜é˜²æŠ–ï¼Œæƒ³å¿…ç”µæ¢¯å¾ˆç†Ÿæ‚‰å§ï¼Œä¸‹é¢æ¥ä¸€å¼ å¤§ä¼™æ’é˜Ÿè¿›å…¥ç”µæ¢¯çš„åŠ¨æ¼«å›¾

![8644ebf81a4c510f660c27b12f0f6a2bd52aa](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3122d3c148434c109c3f97f313653378~tplv-k3u1fbpfcp-zoom-1.image)

çœ‹ä¸Šå›¾ï¼Œå¤§ä¼™ä¸€ä¸ªæ‹ä¸€ä¸ªæ¥ç€è¿›å…¥ç”µæ¢¯ï¼Œç”µæ¢¯ä¼šç­‰åˆ°æœ€åä¸€ä¸ªäººè¿›å»ä¹‹åï¼Œå†è¿‡ä¸Šè®¾å®šå¥½çš„ç§’æ•°ä¹‹åå…³é—­ç”µæ¢¯é—¨ï¼Œæ‰§è¡Œä¸Šæˆ–è€…ä¸‹çš„å‡½æ•°ã€‚

è¿™å°±æ˜¯ä¸€ä¸ªå¾ˆå½¢è±¡çš„é˜²æŠ–ï¼Œå¦‚æœä¸€ç›´å†è§¦å‘é˜²æŠ–å‡½æ•°ï¼Œé‚£ä¹ˆé˜²æŠ–å‡½æ•°ä¼šç­‰å¾…è§¦å‘çš„åŠ¨æœºæ¶ˆåœäº†ï¼Œå†ç­‰ä¸Šè®¾å®šå¥½çš„æ—¶é—´ï¼Œæœ€åæ‰ä¼šå»æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

å†æ¥ä¸€ä¸ªå®é™…å¼€å‘ä¸­çš„æ¡ˆä¾‹:

ç›‘å¬æ»šåŠ¨æ¡æ»šåŠ¨äº‹ä»¶ï¼ˆå®é™…ä¸Šå…¶å®ƒäº‹ä»¶ä¹Ÿå¯ä»¥åˆ›é€ è¿™ç§æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šé¼ æ ‡ç§»åŠ¨ï¼‰, ç„¶åè¿”å›æ‰“å°å‡ºæ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„é«˜åº¦

```js
window.onscroll = listenScroll;

function listenScroll() {
  let scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
  console.log('æ»šåŠ¨æ¡è·ç¦»é¡¶éƒ¨çš„é«˜åº¦: ', scrollTop);
}
```

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dcb6b2729644aa38964ac04ac104019~tplv-k3u1fbpfcp-zoom-1.image" style="zoom: 33%;" />

ä»…ä»…æ˜¯ä»ä¸Šé¢æ»šåŠ¨åˆ°ä¸‹é¢,å°±æ‰“å°äº†ä¸€å¤§æ‰¹.

è™½ç„¶æ»¡è¶³éœ€æ±‚, ä½†è¿™ä¹Ÿå¼•å‘å‡ºä¸€ä¸ªé—®é¢˜, æˆ‘çœŸçš„éœ€è¦è¿™ä¹ˆé¢‘ç¹çš„å»ç›‘å¬æ»šåŠ¨äº‹ä»¶å—? å‡å¦‚æˆ‘ç›‘å¬çš„äº‹ä»¶å¤„ç†é‡Œé¢æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„æ“ä½œ, é‚£è¿™æ ·ä¸æ˜¯ç™½ç™½æµªè´¹äº†æµè§ˆå™¨æ€§èƒ½å—?

æœ‰åŠæ³•è§£å†³å—?

æœ‰ , å°±å’Œæˆ‘ä¸Šé¢ä»‹ç»çš„ä¸Šç”µæ¢¯æ˜¯ä¸€ä¸ªæ€§è´¨çš„é—®é¢˜, è§£å†³åŠæ³•å°±æ˜¯ : æˆ‘ç­‰æ‰€æœ‰äººéƒ½ä¸Šæ¥äº†, å†å»æ‰§è¡Œå…³é—­ç”µæ¢¯é—¨.

åŒç†è¿™é‡Œå°±æ˜¯: æˆ‘ç­‰å¾…ç”¨æˆ·åœæ­¢æ“ä½œæ»šåŠ¨æ¡äº†, æˆ‘å†å»å›è°ƒå‡½æ•°, è‡³äºè¿™ä¸ªæ€ä¹ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœæ­¢æ“ä½œæ»šåŠ¨æ¡è¿™å°±å› äººè€Œå¼‚äº†(200ms æœªæ“ä½œæ»šåŠ¨æ¡ æˆ–è€… 300ms ä¹Ÿè¡Œ)

è¿™é‡Œç»™äº†ä¸€ä¸ªç®€å•ç‰ˆæœ¬çš„é˜²æŠ–å‡½æ•°,ä¸»è¦è¿ç”¨äº†**é—­åŒ…**ä¿å­˜å®šæ—¶å™¨

```js {7}
/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} delay - ç­‰å¾…æ—¶é—´
 */
function debounce(fn, delay) {
    let timer = null;  // ç”±é—­åŒ…ä¿å­˜çš„å±€éƒ¨å˜é‡
    return function () {
        // è¿™é‡Œè¡¨ç¤ºå¦‚æœæœ‰timer,åˆ™è¯´æ˜ä¹‹å‰æœ‰è°ƒç”¨è¿‡,è§£é™¤ä¹‹å‰çš„å®šæ—¶å™¨;é‡æ–°è®¾ç½®å®šæ—¶å™¨è®¡æ—¶å›è°ƒå‡½æ•°è§¦å‘çš„æ—¶æœºâ²
        if (timer) {
            clearTimeout(timer);
        }
        timer = setTimeout(fn, delay);
    };
}
function listenScroll () {
    // do
}
ä½¿ç”¨æ—¶åˆ™éœ€è¦æŠŠä¸Šé¢ç›‘å¬çš„å‡½æ•°çš„æ–¹å¼æ”¹ä¸€ä¸‹
window.onscroll = listenScroll
- æ”¹æˆ:
window.onscroll = debounce(listenScroll, 200)

```

![image-20220103102829414](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f2e4ee35d9e4508a22068d70dcee0fc~tplv-k3u1fbpfcp-zoom-1.image)

åŒæ ·çš„å›è°ƒå‡½æ•°ç»è¿‡`debounce`é˜²æŠ–å¤„ç†ä¹‹åæˆ‘ä»¬çœ‹åˆ°æ•ˆæœå·²ç»å¥½å¾ˆå¤šäº†ä»…ä»…è§¦å‘äº†ä¸‰æ¬¡(æ»šåŠ¨è¿‡ç¨‹ä¸­æˆ‘æ‹–åŠ¨æ»šåŠ¨æ¡æœ‰åœé¡¿, æ‰‹æ®‹å…š ğŸ˜‚ ) è¿™å°±èƒ½è¾¾åˆ°å¾ˆå¥½çš„é™ä½è§¦å‘å›è°ƒå‡½æ•°çš„é¢‘ç‡äº†!

### åº”ç”¨åœºæ™¯

- scroll æ»šåŠ¨äº‹ä»¶ã€æµè§ˆå™¨çª—å£ç¼©æ”¾äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç­‰ç­‰
- æœç´¢æ¡†è¾“å…¥æŸ¥è¯¢äº‹ä»¶
- æŒ‰é’®æäº¤äº‹ä»¶ï¼ˆæ‹’ç»é‡å¤æäº¤å‘é€è¯·æ±‚ï¼‰

---

### é«˜é…é˜²æŠ–

ä¸Šæ–‡[é˜²æŠ–ç®€ä»‹](https://juejin.cn/post/6998732773730615327)ä¸­ç®€å•ä»‹ç»äº†ä¸€ä¸‹é˜²æŠ–çš„ä½¿ç”¨åœºæ™¯ä»¥åŠä¸€ä¸ªç®€å•ç‚¹å®ç°çš„ä¾‹å­ã€‚æœ‰æ²¡æœ‰åŠŸèƒ½ä¸°å¯Œçš„é˜²æŠ–ï¼Ÿæœ‰çš„ï¼Œä¸€äº› JS åº“åŸºæœ¬ä¹Ÿä¼šå°è£…é˜²æŠ–èŠ‚æµã€ æœ¬æ–‡å°†é˜…è¯»[underscore](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flessfish%2Funderscore-analysis%2Fblob%2Fmaster%2Funderscore-1.8.3.js%2Fsrc%2Funderscore-1.8.3.js)åº“ä¸­çš„é˜²æŠ–å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦è§£å†³äº†ä¸‰ä¸ªé—®é¢˜

- æ‰§è¡Œå‡½æ•°çš„ this æŒ‡å‘é—®é¢˜
- æ‰§è¡Œå‡½æ•°çš„å‚æ•°è·å–é—®é¢˜
- ç«‹å³æ‰§è¡Œ

### this æŒ‡å‘é—®é¢˜

è¿™é‡Œ`listenMoveOn`ä¸­æ‰“å°çš„ this æŒ‡å‘ windowï¼ŒåŸå› åœ¨äº`listenMoveOn`æ˜¯é€šè¿‡`setTimeout`è°ƒç”¨çš„ï¼Œè¿˜è®°å¾—è¿™æ˜¯è°çš„æ–¹æ³•å—ï¼Ÿ`window.setTimeout`ï¼Œå°±æ˜¯å®ƒ`window`ï¼ï¼ï¼æ‰€ä»¥`listenMoveOn`ä¸­çš„ this æŒ‡å‘ window

ç”±äº`onmousemove`ç›‘å¬çš„å›è°ƒæ˜¯`debounce`å‡½æ•°ä½“è¿”å›çš„é‚£ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä½“å†…çš„ this æ˜¯æŒ‡å‘è¿™ä¸ª dom å…ƒç´ çš„

```js
function listenMoveOn() {
    // this -> window
}
function debounce(fn, delay) {
    ...
    return function () {
        // this -> dom
    };
}
```

æ—¢ç„¶äº‹æƒ…å·²ç»æ˜äº†ï¼Œé‚£ä¹ˆæ”¹å˜`listenMoveOn`å‡½æ•°ä½“ä¸­çš„ this æŒ‡å‘åº”è¯¥ä¸æ˜¯éš¾äº‹äº†å§ï¼Ÿå¦‚ä¸‹ä½¿ç”¨ apply

```js
function listenMoveOn() {
    // this -> dom
}
function debounce(fn, delay) {
    ...
    return function () {
        // this -> dom
        ...
        timer = setTimeout(() => {
            fn.apply(this)			// åœ¨è¿™é‡Œæ”¹å˜listenMoveOnçš„thisæŒ‡å‘
        }, delay);
    };
}
```

### ä¼ å‚é—®é¢˜

è¿™ä¸ªé—®é¢˜å…¶å®å¯ä»¥å’Œ this æŒ‡å‘ä¸€èµ· è§£å†³ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³å¤šè¯´ä¸¤å¥ï¼Œå› ä¸ºæˆ‘ç›‘å¬é¼ æ ‡ç§»åŠ¨çš„äº‹ä»¶æ˜¯`debounce`å‡½æ•°ä½“è¿”å›çš„é‚£ä¸ªå‡½æ•°ï¼Œjs äº‹ä»¶é€šå¸¸éƒ½ä¼šè¿”å›ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œæˆ‘ç›®å‰åªèƒ½åœ¨`debounce`ä¸­è·å–ï¼Œåœ¨äº‹ä»¶å›è°ƒä¸­æ˜¯è·å–ä¸åˆ°çš„ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹

```js
function listenMoveOn(...args) {
    let [event] = args
    // argså¯ä»¥è·å–åˆ°äº‹ä»¶ç›‘å¬è¿”å›çš„äº‹ä»¶å¯¹è±¡
    // this -> dom
}
function debounce(fn, delay) {
    ...
    return function (...args) {
        // this -> dom
        ...
        timer = setTimeout(() => {
            fn.apply(this, args)	// åœ¨è¿™é‡Œæ”¹å˜listenMoveOnçš„thisæŒ‡å‘çš„åŒæ—¶ä¼ å…¥ç›‘å¬å¯¹è±¡è·å–åˆ°çš„å‚æ•°
        }, delay);
        // æˆ–è€…
        timer = setTimeout(fn.bind(this, ...args), delay) // æ›´ç®€æ´
    };
}
```

### ç«‹å³æ‰§è¡Œ

ä½¿ç”¨ contextã€param åˆ†åˆ«ä¿å­˜ä¸Šä¸‹æ–‡ã€å‚æ•°ï¼›ç”¨ timer å®šä¹‰å®šæ—¶å™¨ï¼Œå½“å‰æ—¶é—´é…åˆ timestamp åšé—´éš”æ—¶é—´åˆ¤æ–­ï¼Œresult ä¿å­˜å‡½æ•°è°ƒç”¨ç»“æœ

ä¸»å‡½æ•°ï¼š

- ä¿å­˜ä¸Šä¸‹æ–‡ã€å‚æ•°ï¼›
- æ›´æ–° timestamp æ—¶é—´å¿«ç…§ï¼›
- åšåˆå§‹åŒ–æ—¶ç«‹å³è°ƒç”¨æ“ä½œ & æ³¨å†Œå®šæ—¶å™¨

laterï¼š

- ç”±äºæ˜¯ setTimeout è°ƒç”¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸ä¼šå¾ˆé¢‘ç¹ï¼Œå…¶ä¸­çš„ **+new Date() æ˜¯æœ‰å¯èƒ½ æ»å timestamp** çš„
- è°ƒç”¨éç«‹å³æ‰§è¡Œçš„æ­¥éª¤

```js {6,9,22}
function debounce(fn: Function, delay: number, immediate: boolean) {
  let context, params, timer, timestamp, result;
  // æ‰§è¡Œåç»­æ—¶é—´åˆ¤æ–­ï¼Œå‡½æ•°è°ƒç”¨
  const later = () => {
    // è°ƒç”¨é—´éš”æ—¶é—´, å› ä¸ºtimestampæ˜¯ä¸€ç›´å˜åŒ–çš„ï¼Œä½†æ˜¯+new Date() æ˜¯è°ƒç”¨setTimeoutåæ‰èƒ½è·å–åˆ°
    const last = +new Date() - timestamp;
    if (last < delay && last >= 0) {
      // é‡ç½®
      timer = setTimeout(later, delay);
    } else {
      // åˆ°è¿™é‡Œæ•´ä¸ªæµç¨‹ç»“æŸï¼Œå¦‚æœä¸æ˜¯ç«‹å³è°ƒç”¨çš„ï¼Œåˆ™åœ¨è¿™é‡Œæ‰§è¡Œ
      timer = null;
      if (!immediate) {
        result = fn.apply(context, ...params);
        context = params = null;
      }
    }
  };
  return function (this: unknown, ...args) {
    context = this;
    params = args;
    timestamp = +new Date(); // æ›´æ–°æ—¶é—´å¿«ç…§

    let callNow = immediate && !timer;
    if (!timer) timer = setTimeout(later, delay);
    if (callNow) {
      result = fn.apply(context, ...params);
      context = params = null;
    }
    return result;
  };
}
```

åœ¨ä¸€ä¸ªè°ƒç”¨å‘¨æœŸå†…ï¼Œç«‹å³æ‰§è¡Œå’Œéç«‹å³æ‰§è¡Œçš„è¿è¡Œæ¬¡æ•°æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”**æ¬¡æ•°æ˜¯ 1**ï¼Œdelay æœŸé—´å†…ä¸ä¼šå†å»æ‰§è¡Œ

- å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨ delay æ—¶é—´å†…ï¼Œåœ¨å¼€å§‹æ—¶æ‰§è¡Œï¼Œ
- å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨ delay æ—¶é—´ç»“æŸåï¼Œåœ¨æœ«å°¾æ—¶æ‰§è¡Œã€‚

| ç±»åˆ«       | 0ms   | 200ms |
| ---------- | ----- | ----- |
| ç«‹å³æ‰§è¡Œ   | **1** |       |
| éç«‹å³æ‰§è¡Œ |       | **1** |

---

## èŠ‚æµ

èŠ‚æµåº”ç”¨äºï¼šå½“é‡å¤è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œè‡³å°‘æ¯éš” **wait**æ¯«ç§’è°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•°ã€‚å¯¹äºæƒ³æ§åˆ¶ä¸€äº›è§¦å‘é¢‘ç‡è¾ƒé«˜çš„äº‹ä»¶æœ‰å¸®åŠ©ã€‚å°±åƒæ˜¯æœªå®Œå…¨æ‰“å¼€çš„æ°´é¾™å¤´ä¸€æ ·ï¼Œä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸‹æµï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½ç›¸å½“äºè°ƒç”¨äº†ä¸€æ¬¡å›è°ƒå‡½æ•°ã€‚

<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a8f467c7e8e4d949dfe024a9d747fb1~tplv-k3u1fbpfcp-zoom-1.image" style="zoom:25%;" />

èŠ‚æµå¸¸è§åº”ç”¨åœºæ™¯æœ‰ï¼š

- è·å–è¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼Œæ¯”å¦‚é£ä¹¦æ–‡æ¡£å¯ä»¥çœ‹åˆ°å½“å‰æ–‡æ¡£æœ‰è°æ­£åœ¨æŸ¥çœ‹ï¼Œé‚£ä¹ˆå¯ä»¥**ä½¿ç”¨èŠ‚æµå»è½®è¯¢**

### ç‰ˆæœ¬ä¸€ï¼šæ—¶é—´æˆ³å®ç°

é€šè¿‡æ—¶é—´æˆ³å®ç°èŠ‚æµï¼Œè¿™ç§æ–¹å¼ä¼šåœ¨è¿›å…¥ throttle å‡½æ•°ä¸­å°±ä¼šè§¦å‘äº‹ä»¶ç›‘å¬å›è°ƒ

```js
/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} wait - è§¦å‘é—´éš”æ—¶é—´
 */
function throttle(fn, wait) {
  let timer, old, now, context, args;
  old = 0;

  return function () {
    context = this;
    args = arguments;
    now = +new Date();
    if (now - old > wait) {
      // å› ä¸º now - 0 å¿…å®šå¤§äºwaitï¼Œæ‰€ä»¥è¿™ç§å®ç°æ–¹å¼ é¦–æ¬¡è‚¯å®šä¼šè§¦å‘
      fn.apply(context, args);
      old = now;
    }
  };
}
```

### ç‰ˆæœ¬äºŒï¼š`setTimeout`å®ç°

ä½¿ç”¨`setTimeout`å®ç°èŠ‚æµï¼Œè¦ç­‰åˆ°æ—¶é—´è¾¾æ ‡æ‰ä¼šå»è§¦å‘ï¼Œæ‰€ä»¥é¦–æ¬¡ä¸ä¼šè§¦å‘ï¼Œåé¢å‡ºå»ä¹‹åç”±äºæœ‰`setTimeout`çš„å­˜åœ¨ï¼Œè¿˜ä¼šè¡¥ä¸Šä¸€æ¬¡

```js
/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} wait - è§¦å‘é—´éš”æ—¶é—´
 */
function throttle(fn, wait) {
  let timer, context, args;

  return function () {
    context = this;
    args = arguments;
    if (!timer) {
      timer = setTimeout(() => {
        timer = null; // ç¡®ä¿ä¸‹æ¬¡è¿›æ¥æ—¶èƒ½å¤Ÿé‡æ–°è®¾ç½®å®šæ—¶å™¨
        fn.apply(context, args);
      }, wait);
    }
  };
}
```

---

### é«˜é…èŠ‚æµ

å‰æ–‡è®²åˆ°ä¸¤ç§å®ç°ç‰ˆæœ¬çš„èŠ‚æµï¼Œè¿™é‡Œçš„é«˜é…ç‰ˆæœ¬ä¸»è¦å°†æŠŠè¿™ä¸¤ç§ç‰ˆæœ¬è¿›è¡Œä¼˜åŠ¿äº’è¡¥ï¼Œåˆå¹¶æˆä¸€ä¸ªèŠ‚æµå‡½æ•°

### åˆ†æ

ä½¿ç”¨`æ—¶é—´æˆ³`å¯ä»¥è®©èŠ‚æµå‡½æ•°ç«‹å³æ‰§è¡Œï¼Œä½¿ç”¨`setTimeout`å¯ä»¥è®©èŠ‚æµå‡½æ•°å»¶è¿Ÿæ‰§è¡Œï¼Œé€šè¿‡å˜é‡æ§åˆ¶å³å¯ä»¥è¾¾åˆ°ä»¥ä¸Šéœ€æ±‚

é€šè¿‡é«˜é…ç‰ˆçš„èŠ‚æµ ï¼Œè¾¾åˆ°é…ç½®ä»¥ä¸‹å››ç§æƒ…å†µï¼š

- å¼€å§‹æ‰§è¡Œï¼Œæœ«å°¾ä¸æ‰§è¡Œ
- å¼€å§‹ä¸æ‰§è¡Œï¼Œæœ«å°¾æ‰§è¡Œ
- å¼€å§‹æ‰§è¡Œï¼Œæœ«å°¾æ‰§è¡Œ
- å¼€å§‹ä¸æ‰§è¡Œï¼Œæœ«å°¾ä¸æ‰§è¡Œ

### ä»£ç å®ç°

```js
/**
 *
 * @param {function} fn - å›è°ƒå‡½æ•°
 * @param {number} wait - ç­‰å¾…æ—¶é—´
 * @param {obejct} options - é…ç½®ä¸‰ç§æƒ…å†µ
 *   options = {leading: true, trailing: false}ï¼› leading æ§åˆ¶ç¬¬ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œï¼› trailing æ§åˆ¶æœ€åä¸€æ¬¡æ˜¯å¦æ‰§è¡Œ
 */
function throttle(fn, wait, options) {
  /**
   *
   * @param timer - å®šæ—¶å™¨
   * @param now - å½“å‰æ—¶é—´
   * @param context - ä¿å­˜ä¸Šä¸‹æ–‡ä½¿ç”¨
   * @param args - ä¿å­˜äº‹ä»¶å‚æ•°ä½¿ç”¨
   */
  let timer, now, context, args;
  old = 0;

  // è®¾ç½®é»˜è®¤æƒ…å†µï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæœ€åä¸€æ¬¡ä¸æ‰§è¡Œï¼‰
  if (!options) options = { leading: true, trailing: false };

  const later = () => {
    // è¿™é‡Œé‡ç½®old æ˜¯ä¸ºäº†é¿å…leadingã€trailingåŒæ—¶ä¸ºtrueä¸æ—¶é—´æˆ³é‚£è¾¹ç›¸äº’å½±å“ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºæ¸…é™¤äº†æ—¶é—´æˆ³é‚£è¾¹çš„æ“ä½œ
    old = now;

    clearTimeout(timer);
    timer = null;
    fn.apply(context, args);
  };

  return function () {
    // åŒé˜²æŠ–ä¸€æ ·ï¼Œéœ€è¦é—­åŒ…ä¿å­˜ç›¸å…³å˜é‡
    now = +new Date();
    context = this;
    args = arguments;

    // é…ç½® leading èµ°æ—¶é—´æˆ³ç®¡ç†èŠ‚æµ
    if (options.leading && now - old > wait) {
      // è¿™é‡Œé‡ç½®å®šæ—¶å™¨ æ˜¯ä¸ºäº†é¿å…leadingã€trailingåŒæ—¶ä¸ºtrueæ—¶ä¸å®šæ—¶å™¨é‚£è¾¹ç›¸äº’å½±å“ï¼Œè¿™ä¸€æ­¥ç›¸å½“äºæ¸…é™¤äº†å®šæ—¶å™¨é‚£è¾¹çš„æ“ä½œ
      if (timer) {
        clearTimeout(timer);
        timer = null;
      }

      old = now;
      fn.apply(context, args);
    }
    // é…ç½® trailing èµ°å®šæ—¶å™¨ç®¡ç†èŠ‚æµ
    if (options.trailing && !timer) {
      timer = setTimeout(later, wait);
    }
  };
}
```

### undercore ä¸­çš„ throttle

æœ€åè¿˜æ˜¯æ¬£èµä¸€ä¸‹ undercore ä¸­çš„ throttle æºç 

```js
_.throttle = function (func, wait, options) {
  var context, args, result;
  var timeout = null;
  var previous = 0;
  if (!options) options = {};

  var later = function () {
    // å®šæ—¶å™¨æ–¹å¼
    previous = options.leading === false ? 0 : _.now();
    timeout = null;
    result = func.apply(context, args);
    if (!timeout) context = args = null;
  };
  return function () {
    var now = _.now();
    if (!previous && options.leading === false) previous = now;
    var remaining = wait - (now - previous);
    context = this;
    args = arguments;
    // æ—¶é—´æˆ³æ–¹å¼
    if (remaining <= 0 || remaining > wait) {
      if (timeout) {
        clearTimeout(timeout);
        timeout = null;
      }
      previous = now;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    } else if (!timeout && options.trailing !== false) {
      timeout = setTimeout(later, remaining);
    }
    return result;
  };
};
```

