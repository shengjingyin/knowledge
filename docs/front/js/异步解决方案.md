å¾—ç›Šäº ES6 çš„`Promise` ä¸ ES7 çš„`asyncã€await` å¯ä»¥ä½¿å¼‚æ­¥æ›´ç®€æ´ï¼Œåœ¨å‘é€å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œä¹‹å‰æˆ‘ä»¬å¸¸ç”¨ ajaxï¼Œå½“å¤šä¸ªå¼‚æ­¥è¯·æ±‚æœ‰åµŒå¥—å…³ç³»æ—¶ï¼Œå®¹æ˜“äº§ç”Ÿå›è°ƒåœ°ç‹±ç°è±¡ï¼Œå¦‚ä¸‹ï¼š

```js
ajax('XXX1', () => {
  // callback å‡½æ•°ä½“
  ajax('XXX2', () => {
    // callback å‡½æ•°ä½“
    ajax('XXX3', () => {
      // callback å‡½æ•°ä½“
    });
  });
});
```

è™½ç„¶å›è°ƒå‡½æ•°åœ¨æˆ‘ä»¬èªæ˜çš„å‰ç«¯æ‰‹ä¸­ä¸ç®—ä¸ªéš¾ç‚¹ï¼Œèƒ½å¤Ÿè§£å†³å¼‚æ­¥è·å–æ•°æ®çš„é¡ºåºé—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæ˜¯å®å®åœ¨åœ¨çš„å¢åŠ äº†å¿ƒæ™ºè´Ÿæ‹…ï¼Œç”±äºåµŒå¥—æ·±ï¼Œéš¾äºç†è§£ã€å¯è¯»æ€§å·®ã€‚

## 2ã€Promise

åœ¨ ES6 æ—¶æœŸæ–°å¢äº† Promiseï¼Œä¸“é—¨ç”¨æ¥è§£å†³å›è°ƒåœ°ç‹±ã€‚Promise å®ç°äº†é“¾å¼è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ then åè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªå…¨æ–° Promiseï¼Œå¦‚æœæˆ‘ä»¬åœ¨ then ä¸­ return ï¼Œreturn çš„ç»“æœä¼šè¢« Promise.resolve() åŒ…è£…

```js
new Promise(resolve => resolve('æ¶ˆæ¯1'))
  .then(res => {
    console.log('ğŸš€ ~ file: å¼‚æ­¥è§£å†³æ–¹æ¡ˆ.md ~ line 24 ~ res', res);
    // æ“ä½œé€»è¾‘
    return new Promise(resolve => resolve('æ¶ˆæ¯2'));
  })
  .then(res => {
    console.log('ğŸš€ ~ file: å¼‚æ­¥è§£å†³æ–¹æ¡ˆ.md ~ line 24 ~ res', res);
    // æ“ä½œé€»è¾‘
    return new Promise(resolve => resolve('æ¶ˆæ¯3'));
  })
  .then(res => {
    // æ“ä½œé€»è¾‘
    console.log('ğŸš€ ~ file: å¼‚æ­¥è§£å†³æ–¹æ¡ˆ.md ~ line 24 ~ res', res);
    return new Promise(resolve => resolve('æ¶ˆæ¯4'));
  });
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e90afaeab9234138bf4d8c9c8a7fafb8~tplv-k3u1fbpfcp-watermark.image?)

ä¼˜ç‚¹ï¼š

- è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜

ç¼ºç‚¹ï¼š

- å¤ªé•¿

### 3ã€Generater

ç‰¹ç‚¹ï¼š

- å¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œï¼Œå¯ä»¥é…åˆ co å‡½æ•°åº“ä½¿ç”¨

```js
function* fetch() {
  yield ajax('XXX1', () => {});
  yield ajax('XXX2', () => {});
  yield ajax('XXX3', () => {});
}
let it = fetch();
let result1 = it.next();
let result2 = it.next();
let result3 = it.next();
```

### 4ã€Async/await

ä¼˜ç‚¹ï¼š

- **ä»£ç æ¸…æ™°ï¼Œä¸ç”¨åƒ Promise å†™ä¸€å¤§å † then é“¾ï¼Œå¤„ç†äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜**
- ä»£ç é‡å°‘

ç¼ºç‚¹ï¼š

- å°†å¼‚æ­¥ä»£ç æ”¹é€ æˆåŒæ­¥ä»£ç ï¼Œå¦‚æœå„ä¸ªå¼‚æ­¥æ¨¡å—æ²¡æœ‰ä¾èµ–ï¼ˆå‰åï¼‰å…³ç³»ï¼Œé‚£ä¹ˆä¼šå½±å“æ€§èƒ½

```js
async function test() {
  // ** ä»¥ä¸‹ä»£ç æ²¡æœ‰ä¾èµ–æ€§çš„è¯ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ Promise.all çš„æ–¹å¼
  // å¦‚æœæœ‰ä¾èµ–æ€§çš„è¯ï¼Œå…¶å®å°±æ˜¯è§£å†³å›è°ƒåœ°ç‹±çš„ä¾‹å­äº†
  await fetch('XXX1');
  await fetch('XXX2');
  await fetch('XXX3');
}
```

### await ç»ƒä¹ é¢˜

```js
let a = 0;
let b = async () => {
  a = a + (await 10);
  console.log('2', a); // -> '2' 10
};
b();
a++;
console.log('1', a); // -> '1' 1
```

åŸå› :

- é¦–å…ˆå‡½æ•° `b` å…ˆæ‰§è¡Œï¼Œåœ¨æ‰§è¡Œåˆ° `await 10` ä¹‹å‰å˜é‡ `a` è¿˜æ˜¯ 0ï¼Œå› ä¸º `await` å†…éƒ¨å®ç°äº† `generator` ï¼Œ**`generator` ä¼šä¿ç•™å †æ ˆä¸­ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™æ—¶å€™ `a = 0` è¢«ä¿å­˜äº†ä¸‹æ¥**
- å› ä¸º `await` æ˜¯å¼‚æ­¥æ“ä½œï¼Œåæ¥çš„è¡¨è¾¾å¼ä¸è¿”å› `Promise` çš„è¯ï¼Œå°±ä¼šåŒ…è£…æˆ `Promise.reslove(è¿”å›å€¼)`ï¼Œç„¶åä¼šå»æ‰§è¡Œå‡½æ•°å¤–çš„åŒæ­¥ä»£ç 
- åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åå¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œå°†ä¿å­˜ä¸‹æ¥çš„å€¼æ‹¿å‡ºæ¥ä½¿ç”¨ï¼Œè¿™æ—¶å€™ `a = 0 + 10`

ä¸Šè¿°è§£é‡Šä¸­æåˆ°äº† `await` å†…éƒ¨å®ç°äº† `generator`ï¼Œå…¶å® `await` å°±æ˜¯ `generator` åŠ ä¸Š `Promise`çš„è¯­æ³•ç³–ï¼Œä¸”å†…éƒ¨å®ç°äº†è‡ªåŠ¨æ‰§è¡Œ `generator`ã€‚å¦‚æœä½ ç†Ÿæ‚‰ co çš„è¯ï¼Œå…¶å®è‡ªå·±å°±å¯ä»¥å®ç°è¿™æ ·çš„è¯­æ³•ç³–ã€‚

> åŸæ–‡è¿æ¥ï¼ˆhttps://github.com/sisterAn/blog/issues/29ï¼‰
