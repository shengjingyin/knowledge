| 修订者 | 版本 | 时间       | 内容                 |
| ------ | ---- | ---------- | -------------------- |
| v1.0   | v1.0 | 2022/10/11 | 项目代码风格统一实践 |

当前系统中，格式化代码+代码质量检测用的工具是 **prettier + eslint** 组合，通过结合**vscode**可以实现一套**保存格式化代码+实时检测代码质量**配置

### **eslint、prettier、vscode三者关系**

vscode：控制代码编写时的风格，需要配置相应的编写时配置；

prettier：格式化代码的插件，需要配置相应的格式化配置；

eslint：实时检测代码质量，需要配置相应的检测规则。

### vscode

**写代码时的风格**由vscode配置决定（比如：tab是几个空格；代码字体大小等等），其配置方式分为两种：

1. 项目中的配置：`.vscode\settings.json`

```JavaScript
{
  "editor.fontSize": 14, // 代码字体大小
  "prettier.printWidth": 120, // 书写代码宽度
  "editor.tabSize": 2, // tab 大小
  "editor.defaultFormatter": "esbenp.prettier-vscode", // 使用prettier作为格式化插件
  "files.autoSave": "onFocusChange", // 文件失焦自动保存
  "prettier.useTabs": true, // 使用tab缩进
  "editor.formatOnSave": true // 保存时格式化
}
```

> 建议以上配置添加到项目中，含有以下功能：
>
> - 失焦自动保存文件内容
>
> - 保存时格式化代码（和失焦配合也能使用）
>
> - 代码输入风格

1. 全局配置：`文件\首选项\设置`

> 这两种配置的参数完全一样，权重：项目中配置文件 > 全局配置文件

全局配置有两种方式，可以在可视化界面配置也可以在`settings.json`文件中配置

可视化界面

![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=MThiN2JiOWM3MTVmMGRiMjUxYjQzMTYxYzRjZDJlZmJfaXR0eGZOdG1jeHc0b2c0TGxSSnU0UUtrYmRVQ2NjanFfVG9rZW46Ym94Y25NTXlyNVZxRHNhRGRtMWk0bkZxc3hjXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)

```
settings.json
```

![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=N2Q5OWYwMjUwMzU1YTU3MDljMTcxMzIzYzhjZmIzMWNfQUxlTXhMaHdhZVJaY3F0aXg4TXAxTU9VSnZVZ3FUcjFfVG9rZW46Ym94Y25FTlFHTE9HTUdmek5hQ2tOSTZzQ3NGXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=YTE1ZjdkYjZjNmY5M2IxZjQ2NzhmOGUwM2RhMDVmN2VfVUg5ZVdJbFpJWWNkZHR0T0I3SnFTaTM2bWN3b0J2clNfVG9rZW46Ym94Y25rYzZ1RG5BT3ZjRE83SnZkTGJoS0JiXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)

### eslint

eslint作为代码质量检测工具，作用是检测书写代码的过程中发现不符合既定规则的代码，效果如图：

![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=N2ExNzQ4N2E5N2ZmMjU4MDkzYWM1MGJkMDVmZWQwY2NfbW1wQ1dZQ3ZERG1yNWloY1F5bFo3cW53bzhrd0pMa2NfVG9rZW46Ym94Y25zOFR6VWhzQ0VLWEd4VFliN3lRdUVjXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)

在配置文件中，通常需要配置：环境（env）、解析器（parser、parserOptions）、继承规则（extends）、启用的规则（rules）。[Configuring ESLint](http://eslint.cn/docs/user-guide/configuring)

在我们的项目中规则这块通常只要观察**extends**和**rules**即可。

#### extends

这里继承的是插件的规则，可以方便快捷的应用插件中自带的规则，而不用自己写rules。比如舆情系统继承了这三个规则：[vue3规则](https://eslint.vuejs.org/rules/one-component-per-file.html)、[ts规则](https://typescript-eslint.io/rules/)、prettier规则。含义是使用这些规则来检测代码，如果代码不符合相应插件中规定的规则，那么报错提示（error、warn、off）

```JavaScript
  extends: [
    'plugin:vue/vue3-recommended', // 关于vue3的配置
    'plugin:@typescript-eslint/recommended', // 关于ts的配置
    'prettier', // prettier
    'plugin:prettier/recommended', // prettier
  ],
```

#### rules

是指需要启用的规则，这里写的规则权重是大于继承中的规则的。比如：继承中的插件开启某个规则，但在rules中手动关闭了，那么这个规则是不会开启的，所以在舆情系统中看到许多规则被off了

```JavaScript
 rules: {
    // ts 规则 https://typescript-eslint.io/rules/
    '@typescript-eslint/ban-ts-ignore': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off', // 函数是否需要明确返回值类型
    '@typescript-eslint/no-explicit-any': 'error', // 禁用any
    '@typescript-eslint/no-var-requires': 'off', // 模块化风格 require | import
    '@typescript-eslint/no-empty-function': 'off',
    // 'no-use-before-define': 'error', // 禁止在变量定义之前使用()
    // '@typescript-eslint/no-use-before-define': 'off',
    '@typescript-eslint/ban-ts-comment': 'error',
    'no-unused-expressions': 'off',
    '@typescript-eslint/no-unused-expressions': 'warn',
    '@typescript-eslint/ban-types': 'off', // 是否禁用大写字符
    '@typescript-eslint/no-non-null-assertion': 'off', // 是否禁用非空断言
    '@typescript-eslint/explicit-module-boundary-types': 'off',

    '@typescript-eslint/no-unused-vars': 'off', // 作用和 no-unused-vars 相同, 没必要重复提示
    // eslint 规则重写
    'no-unused-vars': 'error', // 禁止出现未使用的变量
    'space-before-function-paren': 'off', // 函数左括号之前是否需要空格
    // plugin:vue/vue3-recommended 规则重写
    // vue规则 https://eslint.vuejs.org/rules/one-component-per-file.html
    'vue/script-setup-uses-vars': 'error', // script 中的方法，在template中使用，是否算被使用
    'vue/attributes-order': 'off', // 强制标签属性排序
    'vue/one-component-per-file': 'off', // 检查是否只有一个组件
    'vue/html-closing-bracket-newline': 'off', // 标签末尾是否使用新的一行
    'vue/max-attributes-per-line': 'off', // 一行一个属性
    'vue/multiline-html-element-content-newline': 'off',
    'vue/singleline-html-element-content-newline': 'off', // !失效，强制单行元素换行
    'vue/attribute-hyphenation': 'off', // 属性是否必须使用短横线连接方式
    'vue/require-default-prop': 'off', // props是否需要默认值
    'vue/custom-event-name-casing': 'off', // 应用小驼峰、短横线
    'vue/html-self-closing': [
      'off', // 闭合标签关闭
      {
        html: {
          void: 'always',
          normal: 'never',
          component: 'always',
        },
        svg: 'always',
        math: 'always',
      },
    ],
  },
```

### prettier

prettier是格式化代码的工具，在设置prettier为默认格式化工具之后，也就是在vscode的配置文件settings.json 文件中添加一项配置：

```JavaScript
// .vscode\settings.json
{
     // 使用prettier作为格式化插件
    "editor.defaultFormatter": "esbenp.prettier-vscode",
}
```

再使用格式化快捷键`Alt + Shift + F`  ，调用prettier即可进行格式化代码，另外还有一种快捷方式就是前面提到的保存代码时进行格式化（可以减少一个步骤：主动操作快捷键格式化代码），

```JavaScript
// .vscode\settings.json
{
    "editor.formatOnSave": true // 保存时格式化代码
}
```

到这已经能够调用prettier去格式化代码，接下来可以对格式化代码的风格进行调整，和vscode配置类型，也是配置一些[规则](https://prettier.io/docs/en/options.html)去控制代码风格：

```JavaScript
// 格式化配置 https://prettier.io/docs/en/options.html
// prettier.config.js
module.exports = {
  printWidth: 100, // 书写宽度
  tabWidth: 2, // tab占位
  useTabs: false, // 空格
  semi: true, // 行尾分号
  singleQuote: true, // 字符串单引号
  vueIndentScriptAndStyle: false, // !<script> and <style> 缩进问题
  quoteProps: 'as-needed', // !默认值，
  bracketSpacing: true, // !默认值，在对象文字中的括号之间打印空格
  trailingComma: 'es5', // !默认值，对象尾随逗号
  // jsxBracketSameLine: true, // !失效，使用 bracketSameLine 替代
  bracketSameLine: false, // 末尾元素的 > 收尾符号不换行
  jsxSingleQuote: false, //  !默认值，在 JSX 中使用双引号。
  arrowParens: 'avoid', // 单个参数的箭头函数是否需要括号
  insertPragma: false, // !默认值，头部插入注释
  requirePragma: false, // !默认值，只格式化特点的文件
  proseWrap: 'never', // md 超出长度是否换行
  htmlWhitespaceSensitivity: 'strict', // 指定 HTML 的全局空格敏感性
  endOfLine: 'auto', // 行尾换行
  rangeStart: 0, // !默认值，文件格式化的起始部分
};
```

## 舆情系统配置

### 使用前准备

#### Vscode安装插件prettier 、 eslint

![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=YTQ5NWFkNGNhODUyMTMyODg3MzRiMzIzMzQ1ODhlNGVfRFRvb1VZcFlXajdLRjhRdEFFN3dMSXFvalV1dkRMWDRfVG9rZW46Ym94Y24wNnlkUzg4TkpKVUFQVW5hMmtYTDFkXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)![img](https://pgo8ie4oqj.feishu.cn/space/api/box/stream/download/asynccode/?code=NDY1NzZlMWNkNzMyNmIzY2QwNmY4ZWI3NWM5NDgyMGJfVWRrTGlzMnRBS09Mc0ZpODU5b1RybmQ3aHBsZFlMY3FfVG9rZW46Ym94Y25xbFhiOG9rWGJscEJBaUR3dmRRendjXzE2NjY4NDI1NDQ6MTY2Njg0NjE0NF9WNA)

### 配置

#### Vscode配置

```JavaScript
//  /.vscode/settings.json

{
  "editor.fontSize": 14, // 代码字体大小
  "prettier.printWidth": 120, // 书写代码宽度
  "editor.tabSize": 2, // tab 大小
  "prettier.useTabs": true, // 使用tab缩进
  "editor.defaultFormatter": "esbenp.prettier-vscode", // 使用prettier作为格式化插件
  "files.autoSave": "onFocusChange", // 文件失焦自动保存
  "editor.formatOnSave": true // 保存时格式化
}
```

#### Prettier配置

```JavaScript
module.exports = {
  printWidth: 100, // 书写宽度
  tabWidth: 2, // tab占位
  useTabs: false, // 空格
  semi: true, // 行尾分号
  singleQuote: true, // 字符串单引号
  vueIndentScriptAndStyle: false, // !<script> and <style> 缩进问题
  bracketSameLine: false, // 末尾元素的 > 收尾符号不换行
  arrowParens: 'avoid', // 单个参数的箭头函数是否需要括号
  proseWrap: 'never', // md 超出长度是否换行
  htmlWhitespaceSensitivity: 'strict', // 指定 HTML 的全局空格敏感性
  endOfLine: 'auto', // 行尾换行
};
```

#### Eslint配置

```JavaScript
// @ts-check
const { defineConfig } = require('eslint-define-config');
module.exports = defineConfig({
  root: true, // 定义根路径，拒绝递归父目录
  // 需要开启的语法环境
  env: {
    browser: true,
    node: true,
    es6: true,
  },
  parser: 'vue-eslint-parser',
  // 解析器
  parserOptions: {
    parser: '@typescript-eslint/parser', //  to parse <script> tags
    ecmaVersion: 2020, //  ECMAScript 版本
    sourceType: 'module', // 模块
    jsxPragma: 'React',
    // 额外的语言特性
    ecmaFeatures: {
      jsx: true,
    },
  },
  // 继承
  extends: [
    'plugin:vue/vue3-recommended', // 关于vue3的配置
    'plugin:@typescript-eslint/recommended', // 关于ts的配置
    'prettier', // prettier
    'plugin:prettier/recommended', // prettier
  ],
  rules: {
    // ts 规则 https://typescript-eslint.io/rules/
    '@typescript-eslint/ban-ts-ignore': 'off',
    '@typescript-eslint/explicit-function-return-type': 'off', // 函数是否需要明确返回值类型
    '@typescript-eslint/no-explicit-any': 'error', // 禁用any
    '@typescript-eslint/no-var-requires': 'off', // 模块化风格 require | import
    '@typescript-eslint/no-empty-function': 'off',
    // 'no-use-before-define': 'error', // 禁止在变量定义之前使用()
    // '@typescript-eslint/no-use-before-define': 'off',
    '@typescript-eslint/ban-ts-comment': 'error',
    'no-unused-expressions': 'off',
    '@typescript-eslint/no-unused-expressions': 'warn',
    '@typescript-eslint/ban-types': 'off', // 是否禁用大写字符
    '@typescript-eslint/no-non-null-assertion': 'off', // 是否禁用非空断言
    '@typescript-eslint/explicit-module-boundary-types': 'off',

    '@typescript-eslint/no-unused-vars': 'off', // 作用和 no-unused-vars 相同, 没必要重复提示
    // eslint 规则重写
    'no-unused-vars': 'error', // 禁止出现未使用的变量
    'space-before-function-paren': 'off', // 函数左括号之前是否需要空格
    // plugin:vue/vue3-recommended 规则重写
    // vue规则 https://eslint.vuejs.org/rules/one-component-per-file.html
    'vue/script-setup-uses-vars': 'error', // script 中的方法，在template中使用，是否算被使用
    'vue/attributes-order': 'off', // 强制标签属性排序
    'vue/one-component-per-file': 'off', // 检查是否只有一个组件
    'vue/html-closing-bracket-newline': 'off', // 标签末尾是否使用新的一行
    'vue/max-attributes-per-line': 'off', // 一行一个属性
    'vue/multiline-html-element-content-newline': 'off',
    'vue/singleline-html-element-content-newline': 'off', // !失效，强制单行元素换行
    'vue/attribute-hyphenation': 'off', // 属性是否必须使用短横线连接方式
    'vue/require-default-prop': 'off', // props是否需要默认值
    'vue/custom-event-name-casing': 'off', // 应用小驼峰、短横线
    'vue/html-self-closing': [
      'off', // 闭合标签关闭
      {
        html: {
          void: 'always',
          normal: 'never',
          component: 'always',
        },
        svg: 'always',
        math: 'always',
      },
    ],
  },
});
```

### 最后

- 